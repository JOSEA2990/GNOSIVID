<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="Style.css">
</head>
<body>
    <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">Co</div>
        <div>
          <h1>Conocimiento On Demand</h1>
          <div class="muted">MVP — Plataforma de videos</div>
        </div>
      </div>

      <div class="nav-section">
        <h3>Categorías</h3>
        <div class="category" id="categories">
          <div class="cat-item active" data-cat="all">Todos <span class="muted">(12)</span></div>
          <div class="cat-item" data-cat="ingenieria">Ingeniería y Construcción</div>
          <div class="cat-item" data-cat="energia">Energía y Sostenibilidad</div>
          <div class="cat-item" data-cat="tecnologia">Tecnología</div>
          <div class="cat-item" data-cat="profesional">Desarrollo Profesional</div>
        </div>
      </div>

      <!--<div class="nav-section">
        <h3>Tu contenido</h3>
        <div class="category">
          <div class="cat-item" id="my-series">Mi Biblioteca</div>
          <div class="cat-item" id="upload-btn">+ Subir/Agregar</div>
        </div>
      </div> -->

      <!--<div class="nav-section" style="margin-top:22px">
        <h3>Acciones rápidas</h3>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button class="small-btn" id="newSeries">Crear serie</button>
          <button class="small-btn" id="exportCSV">Exportar lista</button>
        </div>
      </div> -->

      <!--<div class="footer">Consejo: reemplaza las rutas de video por tus archivos MP4 o enlaces de YouTube/Vimeo.</div>-->
    </aside>

    <!-- MAIN -->
    <main class="main">
      <div class="controls">
        <div class="search">
          <input id="search" placeholder="Buscar episodios, temas o palabras clave..." />
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="small-btn" id="darkToggle">Modo</button>
          <div class="muted">Usuario: <strong>JM</strong></div>
        </div>
      </div>

      <section>
        <h3 style="margin:6px 0">Cursos y Tutoriales</h3>
        <div class="grid" id="seriesGrid">
          <!-- cards inserted by JS -->
        </div>
      </section>

      <section class="player-card" aria-label="Reproductor">
        <div>
          <div class="video-wrap" id="videoWrap">
            <!-- Video element (replace src) -->
            <video id="player" controls preload="metadata">
              <source src="/videos/primavera_ep1.mp4" type="video/mp4">
              Tu navegador no soporta la etiqueta video. Reemplaza src por un MP4 o usa la función de reproducir YouTube.
            </video>
          </div>

          <div style="margin-top:12px" class="meta">
            <div class="title" id="videoTitle">Primavera P6 — Introducción (Episodio 1)</div>
            <div class="sub" id="videoSub">Guía práctica: EPS, WBS, interfaces y conceptos clave</div>
            <div class="tags" style="margin-top:8px">
              <div class="chip">Primavera P6</div>
              <div class="chip">Planificación</div>
              <div class="chip">Ingeniería</div>
            </div>
          </div>
        </div>

        <aside>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div style="font-weight:700">Episodios</div>
            <div class="muted">Serie: Primavera P6</div>
          </div>

          <div class="episodes" id="episodesList">
            <!-- Episodes injected by JS -->
          </div>

          <!--<div style="margin-top:12px;display:flex;gap:8px">
            <button class="small-btn" id="downloadBtn">Descargar MP3</button>
            <button class="small-btn" id="transcriptBtn">Ver transcripción</button>
          </div>-->
        </aside>
      </section>



    </main>

  </div>

  <script>

    /* ====== Demo data: reemplaza con tu CMS o JSON real ====== */
    const SERIES = [
      {
        id: 'primavera',
        title: 'Primavera P6',
        category: 'ingenieria',
        description: 'Curso práctico de Primavera P6 enfocado en proyectos de construcción',
        episodes: [
          {id:'p6-e1',title:'Introducción a Primavera P6',duration:'10:12',src:'/videos/primavera_ep1.mp4',desc:'Qué es Primavera P6, EPS, WBS y la interfaz.'},
          {id:'p6-e2',title:'Crear un proyecto nuevo',duration:'12:05',src:'/videos/primavera_ep2.mp4',thumb:'xx',desc:'Crear proyectos y calendarios.'},
          {id:'p6-e3',title:'Crear WBS',duration:'10:13',src:'/videos/primavera_ep3.mp4',thumb:'xx',desc:'Estructura de Desglose del Trabajo (WBS).'}
        ]
      },
      
            {
        id: 'project',
        title: 'MS PROJECT',
        category: 'ingenieria',
        description: 'Curso práctico de MS PROJECT enfocado en proyectos de construcción',
      },


      {
        id:'web',title:'Portafolio HTML & CSS',category:'tecnologia',description:'Crea un portafolio profesional con HTML y CSS',episodes:[]
      },

      {
        id:'solar',title:'Sistemas Solares Domésticos',category:'energia',description:'Cálculo y diseño de sistemas solares',episodes:[]
      },

      {
        id:'personal',title:'Manejo de Personal',category:'profesional',description:'Consejos y Casos Reales',episodes:[]
      },
    ];

    /* ====== Utility: render episodes and series ====== */
    const episodesList = document.getElementById('episodesList');
    const seriesGrid = document.getElementById('seriesGrid');
    const player = document.getElementById('player');
    const videoTitle = document.getElementById('videoTitle');
    const videoSub = document.getElementById('videoSub');

    function renderEpisodes(seriesId){
      const s = SERIES.find(x=>x.id===seriesId);
      episodesList.innerHTML = '';
      if(!s) return;
      s.episodes.forEach(ep=>{
        const el = document.createElement('div');
        el.className = 'ep';
        el.innerHTML = `
          <div class="thumb">${ep.title.split(' ').slice(0,2).join(' ')} </div>
          <div class="meta-ep">
            <div class="ep-title">${ep.title}</div>
            <div class="ep-sub">${ep.duration} • ${ep.desc}</div>
          </div>`;
        el.onclick = ()=> playEpisode(s,ep);
        episodesList.appendChild(el);
      });
    }

    function renderSeriesGrid(){
      seriesGrid.innerHTML = '';
      SERIES.forEach(s=>{
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML = `
          <img src="https://placehold.co/600x360?text=${encodeURIComponent(s.title)}" alt="${s.title}" />
          <h4>${s.title}</h4>
          <p>${s.description}</p>
        `;
        card.onclick = ()=>{
          // select series
          document.querySelectorAll('.cat-item').forEach(c=>c.classList.remove('active'));
          document.querySelector('[data-cat="ingenieria"]').classList.add('active');
          renderEpisodes(s.id);
          // play first if exists
          if(s.episodes && s.episodes.length) playEpisode(s,s.episodes[0]);
        }
        seriesGrid.appendChild(card);
      })
    }

    function playEpisode(series, ep){
      // If it's a YouTube link -> replace with iframe
      const src = ep.src || '';
      const videoWrap = document.getElementById('videoWrap');
      videoTitle.textContent = `${series.title} — ${ep.title}`;
      videoSub.textContent = ep.desc || '';

      if(src.includes('youtube.com') || src.includes('youtu.be')){
        // make embed url
        let id = '';
        if(src.includes('youtu.be')) id = src.split('/').pop();
        else try{ id = new URL(src).searchParams.get('v') }catch(e){}
        const iframe = document.createElement('iframe');
        iframe.src = `https://www.youtube.com/embed/${id}`;
        iframe.setAttribute('allow','accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
        iframe.setAttribute('allowfullscreen','');
        videoWrap.innerHTML='';
        videoWrap.appendChild(iframe);
      } else {
        // use HTML5 video
        videoWrap.innerHTML = '';
        const v = document.createElement('video');
        v.controls = true; v.preload='metadata'; v.src = ep.src;
        videoWrap.appendChild(v);
        // replace player ref
      }
    }

    // initial render: show first series and episodes
    renderSeriesGrid();
    renderEpisodes('primavera');

    // play first ep if exists
    const firstSeries = SERIES.find(s=>s.id==='primavera');
    if(firstSeries && firstSeries.episodes && firstSeries.episodes[0]){
      playEpisode(firstSeries, firstSeries.episodes[0]);
    }

    /* ====== interactivity: search, category filters, download transcript (mock) ====== */
    document.getElementById('search').addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase();
      // simple filter across episodes
      episodesList.innerHTML='';
      const matched = [];
      SERIES.forEach(s=>{
        s.episodes.forEach(ep=>{
          if(ep.title.toLowerCase().includes(q) || (ep.desc||'').toLowerCase().includes(q)) matched.push({s,ep});
        })
      })
      if(q.trim()==='') return renderEpisodes('primavera');
      if(matched.length===0) episodesList.innerHTML = '<div class="muted">No se encontraron resultados.</div>';
      matched.forEach(item=>{
        const el = document.createElement('div');
        el.className='ep';
        el.innerHTML = `<div class="thumb">${item.ep.title.split(' ').slice(0,2).join(' ')}</div>
                        <div class="meta-ep"><div class="ep-title">${item.ep.title}</div>
                        <div class="ep-sub">${item.ep.duration} • ${item.s.title}</div></div>`;
        el.onclick = ()=> playEpisode(item.s, item.ep);
        episodesList.appendChild(el);
      })
    })

    document.querySelectorAll('.cat-item').forEach(el=>{
      el.addEventListener('click', ()=>{
        document.querySelectorAll('.cat-item').forEach(c=>c.classList.remove('active'));
        el.classList.add('active');
        const cat = el.dataset.cat;
        // filter seriesGrid by category
        seriesGrid.innerHTML='';
        const list = (cat==='all' || !cat) ? SERIES : SERIES.filter(s=>s.category===cat);
        list.forEach(s=>{
          const card = document.createElement('div');
          card.className='card';
          card.innerHTML = `<img src="https://placehold.co/600x360?text=${encodeURIComponent(s.title)}" alt="${s.title}" /><h4>${s.title}</h4><p>${s.description}</p>`;
          card.onclick = ()=>{ renderEpisodes(s.id); if(s.episodes && s.episodes[0]) playEpisode(s,s.episodes[0]); }
          seriesGrid.appendChild(card);
        })
      })
    })

    // small actions
    /* ====== document.getElementById('upload-btn').addEventListener('click', ()=>alert('Función subir/Agregar: en el MVP, reemplaza manualmente el arreglo SERIES en el código con tus videos.'))====== */

    /* ====== document.getElementById('newSeries').addEventListener('click', ()=>{
      const name = prompt('Nombre de la nueva serie:');
      if(!name) return;
      SERIES.push({id:name.toLowerCase().replace(/\s+/g,'-'),title:name,category:'ingenieria',description:'Nueva serie',episodes:[]});
      renderSeriesGrid();
      alert('Serie creada en la data local. Para persistencia necesitas backend o almacenamiento.');
    });====== */

    /* ====== document.getElementById('downloadBtn').addEventListener('click', ()=>{
      alert('Descarga de MP3: para habilitar, agrega la ruta del MP3 en la propiedad ep.audio y genera blob/downlaod. En este demo es solo una acción placeholder.');
    })  ====== */
     /* ====== document.getElementById('transcriptBtn').addEventListener('click', ()=>{
      alert('Transcripción: pega la transcripción generada por ElevenLabs o tu editor en la base de datos y muéstrala aquí.');
    })  ====== */

   /* ====== document.getElementById('exportCSV').addEventListener('click', ()=>{
      // quick export of titles
      let csv = 'serie,episodio,duracion,src\n';
      SERIES.forEach(s=> s.episodes.forEach(ep=> csv += `${s.title.replaceAll(',', '')},${ep.title.replaceAll(',', '')},${ep.duration},${ep.src}\n`));
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='catalogo_videos.csv'; a.click();
      URL.revokeObjectURL(url);
    }) ====== */

    // dark toggle - demo that toggles theme colors (simple)
    document.getElementById('darkToggle').addEventListener('click', ()=>{
      document.body.style.background = (document.body.style.background.includes('#fff') ? 'linear-gradient(180deg,#071024 0%, var(--bg) 100%)' : '#f8fafc');
      // Note: in a full app you'd swap theme variables and CSS.
      alert('Modo alterno (demo): para tema real, implementa variables CSS en el servidor o con prefers-color-scheme.')
    })

  </script>
</body>
</html>